<div class="modal-header">
    <h3 class="modal-title">Add Collaborator to Project</h3>
    <div class="page-header">
        <p class="subheader">Collaborate with others within or outside of ECA.</p>
        <p class="subheader">Showing {{view.collaborators.length}} collaborators.</p>
        <div class="spinner" ng-show="view.isLoading">
            <div class="bounce1"></div>
            <div class="bounce2"></div>
            <div class="bounce3"></div>
        </div>
    </div>
</div>
<div class="modal-body">
    <div st-table="view.collaborators" ng-show="!view.isLoading" class="fixedHeaderTable" style="height:350px;">
        <table class="col-md-12 alt">
            <thead>
                <tr>
                    <th colspan="4">
                        <div>
                            Sharing With
                        </div>
                        <input type="text"
                               class="form-control"
                               typeahead-input-formatter="view.addedCollaboratorFormatter($item)"
                               placeholder="Add a collaborator..."
                               ng-model="view.addedCollaborator"
                               typeahead="user.id as user.displayName for user in view.getUsers($viewValue) | filter : $viewValue | limitTo : view.addCollaboratorLimit"
                               typeahead-on-select="view.onAddCollaboratorSelect($item, $model, $label)"
                               typeahead-template-url="addCollaboratorTemplate.html"
                               typeahead-editable="false" />
                    </th>
                </tr>                
            </thead>
            <tbody class="list2">
                <tr class="hover" ng-repeat="collaborator in view.collaborators">
                    <td class="col-md-3">
                        <h5>
                            {{collaborator.displayName}}
                            <span ng-if="collaborator.isCurrentUser">
                                (Me)
                            </span>
                        </h5>
                        <p class="mute">{{collaborator.emailAddress}}</p>
                    </td>
                    <td class="col-md-3">
                        <div ng-if="collaborator.isEcaUser">
                            ECA
                        </div>
                        <div ng-if="!collaborator.isEcaUser">
                            Outside ECA
                        </div>
                    </td>
                    <!--<td class="col-md-3">
                        <div>
                            <ul ng-repeat="permission in collaborator.rolePermissions">
                                <li>
                                    <ng-switch on="$first || permission.roleName != collaborator.rolePermissions[$index - 1].roleName">
                                        <div ng-switch-when="true" class="title-label"><strong>{{permission.roleName}}</strong></div>
                                    </ng-switch>
                                    <label>
                                        <input type="checkbox"
                                               ng-model="permission.isAllowed"
                                               ng-disabled="view.isSaving || collaborator.isCurrentUser"
                                               ng-change="view.onPermissionCheckboxChange(permission, collaborator)" />
                                        <span tooltip="{{permission.permissionDescription}}">{{permission.permissionName}}</span>
                                    </label>
                                </li>
                            </ul>
                        </div>
                    </td>-->
                    <td class="col-md-3">
                        <div>
                            <ul ng-repeat="permission in collaborator.inheritedPermissions">
                                <li>
                                    <label>
                                        <input type="checkbox"
                                               ng-model="permission.isAllowed"
                                               ng-disabled="view.isSaving || collaborator.isCurrentUser"
                                               ng-change="view.onPermissionCheckboxChange(permission, collaborator)" />
                                        <span tooltip="{{permission.permissionDescription}}">{{permission.permissionName}}</span>
                                    </label>
                                </li>
                            </ul>
                        </div>
                    </td>
                    <td class="col-md-3">
                        <div>
                            <ui-select multiple
                                       ng-model="collaborator.grantedPermissions"
                                       theme="select2"
                                       style="margin-right:10px;"
                                       on-remove="view.onRemovePermission($item, collaborator)"
                                       on-select="view.onSelectPermission($item, collaborator)"
                                       ng-disabled="view.isSaving || collaborator.isCurrentUser">
                                <ui-select-match placeholder="Permissions">
                                    <div>
                                        <span tooltip-append-to-body="true" tooltip="{{$item.permissionDescription}}">{{$item.permissionName}}</span>
                                    </div>
                                </ui-select-match>
                                <ui-select-choices repeat="p in collaborator.availablePermissions | filter: $select.search track by p.permissionId">
                                    <div tooltip-append-to-body="true" tooltip="{{p.permissionDescription}}" ng-bind-html="p.permissionName | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<div class="modal-footer">
    <button class="btn btn-default" ng-click="view.onCloseClick()">Close</button>
</div>
<script type="text/ng-template" id="addCollaboratorTemplate.html">
    <a>
        <div>
            <span bind-html-unsafe="match.model.displayName | typeaheadHighlight:query"></span>
        </div>
        <div ng-show="match.model.email && match.model.email.length > 0" style="margin-left:10px;">
            {{match.model.email}}
        </div>
    </a>
</script>